# Generated by Django 4.2.26 on 2025-11-22 08:53

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('strategies', '0001_initial'),
        ('agents', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='PortfolioModel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('account_name', models.CharField(max_length=100, unique=True, verbose_name='账户名称')),
                ('account_type', models.CharField(choices=[('real', '实盘'), ('simulation', '模拟盘')], default='simulation', max_length=20, verbose_name='账户类型')),
                ('initial_capital', models.DecimalField(decimal_places=2, max_digits=20, verbose_name='初始资金')),
                ('total_asset', models.DecimalField(decimal_places=2, max_digits=20, verbose_name='总资产')),
                ('cash', models.DecimalField(decimal_places=2, max_digits=20, verbose_name='现金')),
                ('market_value', models.DecimalField(decimal_places=2, default=0, max_digits=20, verbose_name='持仓市值')),
                ('available_cash', models.DecimalField(decimal_places=2, max_digits=20, verbose_name='可用资金')),
                ('frozen_cash', models.DecimalField(decimal_places=2, default=0, max_digits=20, verbose_name='冻结资金')),
                ('total_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=20, verbose_name='总盈亏')),
                ('total_return', models.DecimalField(decimal_places=4, default=0, max_digits=10, verbose_name='总收益率')),
                ('today_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=20, verbose_name='今日盈亏')),
                ('today_return', models.DecimalField(decimal_places=4, default=0, max_digits=10, verbose_name='今日收益率')),
                ('total_trades', models.IntegerField(default=0, verbose_name='总交易次数')),
                ('win_trades', models.IntegerField(default=0, verbose_name='盈利交易次数')),
                ('lose_trades', models.IntegerField(default=0, verbose_name='亏损交易次数')),
                ('win_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='胜率')),
                ('max_drawdown', models.DecimalField(decimal_places=4, default=0, max_digits=10, verbose_name='最大回撤')),
                ('sharpe_ratio', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True, verbose_name='夏普比率')),
                ('volatility', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True, verbose_name='波动率')),
                ('risk_preference', models.CharField(default='balanced', max_length=50, verbose_name='风险偏好')),
                ('max_position_pct', models.DecimalField(decimal_places=2, default=30, max_digits=5, verbose_name='最大单仓位比例')),
                ('equity_curve', models.JSONField(blank=True, default=list, verbose_name='权益曲线')),
                ('is_active', models.BooleanField(default=True, verbose_name='是否活跃')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '投资组合',
                'verbose_name_plural': '投资组合',
                'db_table': 'portfolio',
            },
        ),
        migrations.CreateModel(
            name='TradeModel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('trade_id', models.CharField(db_index=True, max_length=100, unique=True, verbose_name='交易ID')),
                ('symbol', models.CharField(db_index=True, max_length=50, verbose_name='标的代码')),
                ('action', models.CharField(choices=[('BUY', '买入'), ('SELL', '卖出')], max_length=10, verbose_name='操作')),
                ('account_type', models.CharField(choices=[('real', '实盘'), ('simulation', '模拟盘')], default='simulation', max_length=20, verbose_name='账户类型')),
                ('account_name', models.CharField(blank=True, max_length=100, null=True, verbose_name='账户名称')),
                ('order_price', models.DecimalField(decimal_places=6, max_digits=20, verbose_name='委托价格')),
                ('order_quantity', models.IntegerField(verbose_name='委托数量')),
                ('filled_price', models.DecimalField(blank=True, decimal_places=6, max_digits=20, null=True, verbose_name='成交价格')),
                ('filled_quantity', models.IntegerField(default=0, verbose_name='成交数量')),
                ('status', models.CharField(choices=[('pending', '待执行'), ('submitted', '已提交'), ('partial_filled', '部分成交'), ('filled', '已成交'), ('cancelled', '已取消'), ('failed', '失败')], default='pending', max_length=20, verbose_name='状态')),
                ('order_time', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='委托时间')),
                ('filled_time', models.DateTimeField(blank=True, null=True, verbose_name='成交时间')),
                ('commission', models.DecimalField(decimal_places=2, default=0, max_digits=20, verbose_name='手续费')),
                ('slippage', models.DecimalField(decimal_places=6, default=0, max_digits=10, verbose_name='滑点')),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=20, verbose_name='总金额')),
                ('decision_process', models.JSONField(blank=True, default=dict, verbose_name='决策过程')),
                ('reason', models.TextField(verbose_name='交易原因')),
                ('stop_loss', models.DecimalField(blank=True, decimal_places=6, max_digits=20, null=True, verbose_name='止损价')),
                ('take_profit', models.DecimalField(blank=True, decimal_places=6, max_digits=20, null=True, verbose_name='止盈价')),
                ('execution_quality', models.JSONField(blank=True, default=dict, verbose_name='执行质量')),
                ('execution_time_ms', models.IntegerField(blank=True, null=True, verbose_name='执行耗时(毫秒)')),
                ('pnl', models.DecimalField(blank=True, decimal_places=2, max_digits=20, null=True, verbose_name='盈亏金额')),
                ('pnl_pct', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True, verbose_name='盈亏比例')),
                ('holding_period_hours', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='持有时长(小时)')),
                ('market_price', models.DecimalField(blank=True, decimal_places=6, max_digits=20, null=True, verbose_name='市场价')),
                ('market_vix', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True, verbose_name='VIX指数')),
                ('market_sentiment', models.CharField(blank=True, max_length=50, null=True, verbose_name='市场情绪')),
                ('outcome', models.CharField(blank=True, max_length=50, null=True, verbose_name='结果评价')),
                ('lessons_learned', models.JSONField(blank=True, default=list, verbose_name='教训总结')),
                ('external_order_id', models.CharField(blank=True, max_length=200, null=True, verbose_name='外部订单ID')),
                ('error_message', models.TextField(blank=True, null=True, verbose_name='错误信息')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('decision', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='trades', to='agents.decisionrecordmodel', verbose_name='决策记录')),
                ('strategy', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='trades', to='strategies.strategymodel', verbose_name='策略')),
            ],
            options={
                'verbose_name': '交易记录',
                'verbose_name_plural': '交易记录',
                'db_table': 'trade',
                'ordering': ['-order_time'],
            },
        ),
        migrations.CreateModel(
            name='RiskControlLogModel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('risk_type', models.CharField(choices=[('pre_trade', '交易前风控'), ('in_trade', '交易中风控'), ('post_trade', '交易后风控'), ('system', '系统性风控')], max_length=20, verbose_name='风控类型')),
                ('action', models.CharField(choices=[('allow', '允许'), ('reject', '拒绝'), ('adjust', '调整'), ('alert', '告警'), ('pause', '暂停')], max_length=20, verbose_name='操作')),
                ('risk_indicators', models.JSONField(default=dict, verbose_name='风险指标')),
                ('trigger_rules', models.JSONField(default=list, verbose_name='触发规则')),
                ('description', models.TextField(verbose_name='描述')),
                ('recommendation', models.TextField(verbose_name='建议')),
                ('executed', models.BooleanField(default=False, verbose_name='是否已执行')),
                ('execution_result', models.TextField(blank=True, null=True, verbose_name='执行结果')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='创建时间')),
                ('portfolio', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='risk_logs', to='trades.portfoliomodel', verbose_name='投资组合')),
                ('trade', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='risk_logs', to='trades.trademodel', verbose_name='交易')),
            ],
            options={
                'verbose_name': '风控日志',
                'verbose_name_plural': '风控日志',
                'db_table': 'risk_control_log',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PositionModel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('symbol', models.CharField(db_index=True, max_length=50, verbose_name='标的代码')),
                ('account_type', models.CharField(choices=[('real', '实盘'), ('simulation', '模拟盘')], default='simulation', max_length=20, verbose_name='账户类型')),
                ('account_name', models.CharField(blank=True, max_length=100, null=True, verbose_name='账户名称')),
                ('quantity', models.IntegerField(verbose_name='持仓数量')),
                ('available_quantity', models.IntegerField(verbose_name='可用数量')),
                ('frozen_quantity', models.IntegerField(default=0, verbose_name='冻结数量')),
                ('avg_cost', models.DecimalField(decimal_places=6, max_digits=20, verbose_name='平均成本')),
                ('total_cost', models.DecimalField(decimal_places=2, max_digits=20, verbose_name='总成本')),
                ('current_price', models.DecimalField(blank=True, decimal_places=6, max_digits=20, null=True, verbose_name='当前价格')),
                ('market_value', models.DecimalField(blank=True, decimal_places=2, max_digits=20, null=True, verbose_name='市值')),
                ('unrealized_pnl', models.DecimalField(blank=True, decimal_places=2, max_digits=20, null=True, verbose_name='浮动盈亏')),
                ('unrealized_pnl_pct', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True, verbose_name='浮动盈亏比例')),
                ('realized_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=20, verbose_name='已实现盈亏')),
                ('stop_loss', models.DecimalField(blank=True, decimal_places=6, max_digits=20, null=True, verbose_name='止损价')),
                ('take_profit', models.DecimalField(blank=True, decimal_places=6, max_digits=20, null=True, verbose_name='止盈价')),
                ('opened_at', models.DateTimeField(verbose_name='开仓时间')),
                ('holding_days', models.IntegerField(default=0, verbose_name='持有天数')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='元数据')),
                ('is_closed', models.BooleanField(default=False, verbose_name='是否已平仓')),
                ('closed_at', models.DateTimeField(blank=True, null=True, verbose_name='平仓时间')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('open_trade', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='opened_positions', to='trades.trademodel', verbose_name='开仓交易')),
                ('strategy', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='positions', to='strategies.strategymodel', verbose_name='策略')),
            ],
            options={
                'verbose_name': '持仓',
                'verbose_name_plural': '持仓',
                'db_table': 'position',
                'ordering': ['-opened_at'],
            },
        ),
        migrations.AddIndex(
            model_name='trademodel',
            index=models.Index(fields=['symbol', '-order_time'], name='trade_symbol_a3c3fc_idx'),
        ),
        migrations.AddIndex(
            model_name='trademodel',
            index=models.Index(fields=['status', '-order_time'], name='trade_status_58db1f_idx'),
        ),
        migrations.AddIndex(
            model_name='trademodel',
            index=models.Index(fields=['account_type', '-order_time'], name='trade_account_e22314_idx'),
        ),
        migrations.AddIndex(
            model_name='trademodel',
            index=models.Index(fields=['-order_time'], name='trade_order_t_506544_idx'),
        ),
        migrations.AddIndex(
            model_name='riskcontrollogmodel',
            index=models.Index(fields=['risk_type', '-created_at'], name='risk_contro_risk_ty_e474d5_idx'),
        ),
        migrations.AddIndex(
            model_name='riskcontrollogmodel',
            index=models.Index(fields=['action', '-created_at'], name='risk_contro_action_6f39f6_idx'),
        ),
        migrations.AddIndex(
            model_name='positionmodel',
            index=models.Index(fields=['symbol', 'account_type', 'is_closed'], name='position_symbol_8237c3_idx'),
        ),
        migrations.AddIndex(
            model_name='positionmodel',
            index=models.Index(fields=['account_type', 'is_closed'], name='position_account_97fda3_idx'),
        ),
    ]
